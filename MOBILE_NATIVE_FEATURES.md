# Mobile-Native Features Documentation

This document describes the mobile-native features added to Laterr.

## PWA Features

### Service Worker
The app now includes a service worker for offline support and caching. The service worker is automatically generated by `vite-plugin-pwa` and includes:
- Precaching of static assets
- Runtime caching of Supabase API calls
- Automatic updates when new versions are deployed

### PWA Manifest
The app includes a complete PWA manifest with:
- App name and description
- Theme colors
- Icons (192x192, 512x512, maskable)
- Start URL set to `/bookmarks`
- Standalone display mode

### Icons
PWA icons are generated from the favicon.ico using the script at `scripts/generate-icons.mjs`. Run it with:
```bash
node scripts/generate-icons.mjs
```

Generated icons:
- `public/icons/icon-192.png` - Standard icon 192x192
- `public/icons/icon-512.png` - Standard icon 512x512
- `public/icons/icon-maskable-512.png` - Maskable icon with safe zone
- `public/icons/apple-touch-icon.png` - Apple touch icon 180x180

## Native Interactions

### Haptic Feedback
The `useHapticFeedback` hook provides vibration feedback for mobile devices:

```typescript
import { useHapticFeedback } from "@/shared/hooks/useHapticFeedback";

function MyComponent() {
  const { trigger } = useHapticFeedback();
  
  const handleClick = () => {
    trigger('light'); // Options: 'light', 'medium', 'heavy', 'selection'
  };
}
```

Currently integrated in:
- MobileBottomNav - light haptic on navigation tap

### Pull-to-Refresh
The `PullToRefresh` component provides a native-feeling pull-to-refresh interaction:

```typescript
import { PullToRefresh } from "@/shared/components/PullToRefresh";

function MyPage() {
  const handleRefresh = async () => {
    // Perform refresh logic (e.g., refetch data)
    await refetchData();
  };

  return (
    <PullToRefresh onRefresh={handleRefresh}>
      {/* Your page content */}
    </PullToRefresh>
  );
}
```

Props:
- `onRefresh`: async function called when refresh is triggered
- `children`: content to wrap
- `disabled`: optional, disables pull-to-refresh
- `threshold`: optional, pull distance threshold (default: 80px)

Features:
- Haptic feedback at threshold and on release
- Visual indicator showing pull progress
- Only activates when scrolled to top
- Smooth animations

**Integration examples:**
To integrate pull-to-refresh in pages like Bookmarks or Health, wrap the page content:

```typescript
// In BookmarksPage.tsx
<PullToRefresh onRefresh={handleRefresh}>
  <div className="page-content">
    {/* existing content */}
  </div>
</PullToRefresh>
```

## Visual Enhancements

### Offline Indicator
The `OfflineIndicator` component automatically shows when the device goes offline/online:
- Shows at the top center of the screen
- Red indicator with "You're offline" when offline
- Green indicator with "Back online" when reconnecting
- Auto-hides after 3 seconds when back online

No integration needed - it's already added to `App.tsx`.

### Mobile Bottom Navigation
Enhanced with 4 navigation items:
1. Home (/)
2. Bookmarks (/bookmarks)
3. Health (/health)
4. Subscriptions (/subscriptions)

Features:
- Haptic feedback on tap
- Active state highlighting
- Scale animation on press
- Safe area insets for notched devices

## iOS-Specific Features

### Meta Tags
Added iOS-specific meta tags for better PWA experience:
- Apple mobile web app capable
- Black translucent status bar
- Apple touch icon (180x180)

### Safe Areas
Components use safe area insets for devices with notches:
- Bottom navigation uses `pb-safe`
- Proper spacing for home indicator

## Performance Optimizations

### Preloading
Critical resources are preloaded:
- PWA icons
- Supabase API connection

### Caching Strategy
- Static assets: Precached
- Supabase API: NetworkFirst strategy with 24-hour cache
- Maximum cache size: 3MB

### Code Splitting
Vendor libraries are split into chunks:
- react-vendor
- ui-vendor (Radix UI components)
- supabase-vendor
- utils-vendor

## Testing Mobile Features

### Local Testing
1. Start dev server: `npm run dev`
2. Open in mobile device browser or Chrome DevTools mobile emulator
3. Test pull-to-refresh on pages (when integrated)
4. Test haptic feedback (requires physical device)
5. Test offline mode (disable network in DevTools)

### PWA Installation
1. Build the app: `npm run build`
2. Serve the build: `npm run preview`
3. Open on mobile device
4. Use "Add to Home Screen" option
5. Test offline functionality

### PWA Audit
Use Chrome DevTools Lighthouse to audit PWA features:
1. Open DevTools
2. Go to Lighthouse tab
3. Select "Progressive Web App" category
4. Run audit

## Future Enhancements

Potential improvements for true native feel:
- Capacitor integration for native app distribution
- Push notifications
- Native file system access
- Camera/photo library integration
- Biometric authentication
